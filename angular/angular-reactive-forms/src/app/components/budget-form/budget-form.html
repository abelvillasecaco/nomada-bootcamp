<div class="budget-container">
  <h2>Presupuesto Mensual</h2>

  <form [formGroup]="budgetForm" (ngSubmit)="onSubmit()">

    <div class="form-group">
      <label>Responsable</label>
      <input formControlName="owner" placeholder="Nombre del responsable" />
      @if (control('owner').touched && control('owner').invalid) {
        <small>Nombre requerido (mín 3 caracteres).</small>
      }
    </div>


    <div class="form-group">
      <label>Mes</label>
      <input formControlName="month" placeholder="Ej: Noviembre 2025" />
      @if (control('month').touched && control('month').invalid) {
        <small>Campo requerido.</small>
      }
    </div>

    <h3>Gastos</h3>

    <div formArrayName="expenses">
      @for (ctrl of expenses.controls; track ctrl.value.id; let i = $index) {
        <div [formGroupName]="i" class="expense-item">

          <input formControlName="description" placeholder="Descripción" />

          <input
            formControlName="amount"
            type="number"
            step="0.01"
            placeholder="Monto"
          />

          <input formControlName="category" placeholder="Categoría (opcional)" />

          @if (expenses.length > 1) {
            <button type="button" (click)="removeExpense(i)">Eliminar</button>
          }

          <div class="errors">
            @if (expenseControl(i, 'description').touched && expenseControl(i, 'description').invalid) {
              <small>Descripción requerida</small>
            }
            @if (expenseControl(i, 'amount').touched && expenseControl(i, 'amount').invalid) {
              <small>Monto debe ser mayor que 0</small>
            }
          </div>
        </div>
      } @empty {
        <p>No hay gastos aún. Añade uno.</p>
      }
    </div>

    <button type="button" (click)="addExpense()">+ Añadir gasto</button>

    <hr />

    <p><strong>Total gastos:</strong> {{ getTotal() | number: '1.2-2' }}</p>

    <button type="submit" [disabled]="budgetForm.invalid">Guardar</button>
  </form>

  @if (submitted()) {
    <div class="json-output">
      <h3>JSON del formulario</h3>
      <pre>{{ budgetForm.value | json }}</pre>
    </div>
  }
</div>
